# 商品推荐系统使用教程

本文档提供了如何使用该商品推荐系统的详细步骤，从数据准备到模型训练和推荐生成。

## 1. 准备环境

首先，确保安装了所有必要的依赖：

```bash
pip install -r requirements.txt
```

## 2. 数据准备

系统支持两种数据获取方式：

### 2.1 使用模拟数据

如果您没有真实数据，可以使用我们提供的模拟数据生成脚本：

```bash
python data/generate_mock_data.py
```

这将在`data/`目录下生成以下文件：
- `users.csv`：用户信息
- `products.csv`：商品信息
- `ratings_train.csv`：训练集评分数据
- `ratings_test.csv`：测试集评分数据

### 2.2 使用自己的数据

如果您有自己的数据，请确保它们符合以下格式：

**评分数据**（必需）：包含列 `user_id`, `item_id`, `rating`（可选：`timestamp`）
**用户数据**（可选）：包含至少 `user_id` 列和其他用户特征
**商品数据**（可选）：包含至少 `item_id` 列和其他商品特征

将这些文件分别保存为CSV格式，并按照配置文件中指定的路径放置。

## 3. 配置系统

根据需要修改 `config.py` 文件中的配置：

```python
# 数据路径
DATA_CONFIG = {
    'train_path': 'data/ratings_train.csv',
    'test_path': 'data/ratings_test.csv',
    # ...
}

# 模型参数
MODEL_CONFIG = {
    'embedding_dim': 64,      # 调整嵌入维度
    'hidden_layers': [128, 64, 32],  # 调整网络结构
    'dropout_rate': 0.2,      # 调整Dropout比例
    # ...
}
```

## 4. 训练模型

运行训练脚本：

```bash
python training/train.py
```

训练过程将显示每个epoch的训练损失、验证损失、RMSE和MAE等指标。完成后，模型会保存到 `models/recommender_model.pth`，并生成训练历史曲线图。

## 5. 评估模型

使用评估脚本查看模型性能：

```bash
python evaluate_model.py
```

这将生成包含RMSE、MAE、Precision@K、Recall@K等指标的评估报告，并保存可视化结果。

参数选项：
- `--model_path`：指定要评估的模型路径
- `--k`：Top-K推荐的K值（默认为10）
- `--no_plot`：不生成可视化结果图表

## 6. 生成推荐

使用训练好的模型为用户生成推荐：

```bash
python recommend.py --user_id 123
```

参数选项：
- `--user_id`：用户ID（必需）
- `--top_k`：推荐商品数量（默认为10）
- `--model_path`：指定模型路径
- `--explain`：提供推荐理由

示例输出：
```
为用户 123 的推荐商品:
1. 商品ID: 456, 预测分数: 0.9532
2. 商品ID: 789, 预测分数: 0.8921
...
```

## 7. 冷启动问题处理

推荐系统常见的挑战之一是冷启动问题，即如何为新用户或新商品生成推荐。本系统采用以下策略处理冷启动：

### 新用户
- 为新用户推荐最受欢迎的商品
- 根据用户的基本信息（如年龄、性别）匹配相似用户的喜好

### 新商品
- 基于商品特征（如类别、品牌）进行内容推荐
- 将新商品推荐给对类似商品感兴趣的用户

## 8. 高级使用

### 8.1 调整模型架构

修改 `models/recommender.py` 中的模型架构，可以实验不同的神经网络结构，如：
- 调整嵌入层维度
- 改变隐藏层数量和神经元数量
- 尝试不同的激活函数

### 8.2 特征工程

通过 `utils/data_utils.py` 中添加特征工程逻辑，如：
- 提取时间特征（如季节性、周期性模式）
- 用户行为聚类
- 商品属性嵌入

### 8.3 集成其他模型

您可以按需在 `models/` 目录中添加其他推荐算法，如：
- 基于内容的过滤
- 矩阵分解
- 基于图的推荐

## 9. 常见问题

**Q: 如何处理大规模数据集？**
A: 对于大规模数据集，建议使用数据抽样、增量训练策略，或考虑分布式训练。

**Q: 模型训练很慢怎么办？**
A: 尝试减少嵌入维度、简化网络结构，或使用 `SimplifiedNCF` 模型替代完整的 `NCFModel`。

**Q: 推荐结果不够多样化怎么办？**
A: 在 `recommend.py` 中集成多样性策略，如结合内容相似度与协同过滤，或添加随机因素。

**Q: 如何将模型部署到生产环境？**
A: 考虑使用Flask或FastAPI创建REST API服务，或将模型转换为ONNX格式以优化推理性能。 

**Q：协同过滤也是神经网络的一种吗？** 
A: 协同过滤不是神经网络的一种，它们是两个不同的概念。让我来解释它们的关系：
协同过滤(Collaborative Filtering)是一种推荐算法的类型，其核心思想是利用用户群体的集体智慧来为个体用户提供推荐。传统的协同过滤主要基于以下两种方式：
基于用户的协同过滤：寻找与当前用户相似的其他用户，并推荐这些相似用户喜欢但当前用户尚未接触的商品
基于物品的协同过滤：寻找与用户已经喜欢的商品相似的其他商品进行推荐
而神经网络(Neural Network)是一种机器学习模型，模拟人脑神经元的连接结构，通过多层非线性变换学习数据中的复杂模式。
在我们的项目中使用的神经协同过滤(Neural Collaborative Filtering，NCF)是将神经网络与协同过滤相结合的一种方法。具体来说，它使用神经网络来学习用户和商品之间的交互关系，代替了传统协同过滤中简单的内积运算。这种结合有几个优势：
能够捕捉更复杂的非线性关系
可以灵活地整合用户和商品的特征信息
适应性更强，可以根据数据自动学习最优的表示方式
所以，协同过滤是推荐系统中的一种方法论，而神经网络是一种可以用来实现协同过滤的技术工具。在现代推荐系统中，神经网络已成为实现高效协同过滤的重要技术手段